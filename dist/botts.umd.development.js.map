{"version":3,"file":"botts.umd.development.js","sources":["../src/structures/Logger.ts","../src/structures/BotClass.ts","../src/structures/Command.ts","../src/structures/Event.ts"],"sourcesContent":["import pkg from 'chalk';\r\nconst { red, yellow, blue, magenta, green } = pkg;\r\n\r\nexport enum LogLevel {\r\n\tError = 0,\r\n\tWarning,\r\n\tInfo,\r\n\tDebug,\r\n\tVerbose,\r\n}\r\n\r\ntype LevelStrings = keyof typeof LogLevel;\r\n\r\nexport class Logger {\r\n\tconstructor(level: LogLevel = LogLevel.Info) {\r\n\t\tthis.level = level;\r\n\t}\r\n\r\n\tpublic level: LogLevel;\r\n\tprivate colors = [red, yellow, blue, magenta, green];\r\n\r\n\temit(message: any, level: LevelStrings | LogLevel = LogLevel.Info) {\r\n\t\tif (typeof level == 'string') level = LogLevel[level];\r\n\t\tif (level > this.level) return;\r\n\t\tconsole.log(this.colors[level](`[${LogLevel[level]}]`), message.toString());\r\n\t}\r\n}\r\n","import * as fs from 'fs';\r\nimport path from 'path';\r\nimport {\r\n\tClient,\r\n\tClientOptions,\r\n\tClientUser,\r\n\tCollection,\r\n\tMessage,\r\n\tPartialMessage,\r\n\tSnowflake,\r\n} from 'discord.js';\r\nimport { Command } from './Command';\r\nimport { Logger, LogLevel } from './Logger';\r\nimport { Event } from './Event';\r\n\r\ninterface _BotOptions extends ClientOptions {\r\n\tcommandFolder: string;\r\n\teventFolder: string;\r\n\tlogLevel?: LogLevel;\r\n}\r\n\r\nexport class BotClass extends Client {\r\n\tconstructor(prefix: string, token: string, owners: Snowflake[], options: _BotOptions) {\r\n\t\tsuper(options);\r\n\t\tthis.logger = new Logger(options.logLevel);\r\n\t\tthis.prefix = prefix;\r\n\t\tthis.token = token;\r\n\t\tthis.owners = owners;\r\n\t\tthis.commandFolder = path.resolve(options.commandFolder);\r\n\t\tthis.eventFolder = path.resolve(options.eventFolder);\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tprefix: string;\r\n\ttoken: string;\r\n\tlogger: Logger;\r\n\tuser!: ClientUser;\r\n\tprivate owners: Snowflake[];\r\n\tprivate commands: Collection<string, Command> = new Collection();\r\n\tprivate events: Collection<string, Event> = new Collection();\r\n\tprotected readonly commandFolder: string;\r\n\tprotected readonly eventFolder: string;\r\n\r\n\tasync init() {\r\n\t\ttry {\r\n\t\t\tawait this.registerCommands();\r\n\t\t\tawait this.eventDispatcher();\r\n\t\t\tthis.on('message', message => this.commandDispatcher(message));\r\n\t\t\tthis.on('messageUpdate', message => this.commandDispatcher(message));\r\n\t\t\tawait this.login(this.token);\r\n\r\n\t\t\tsetInterval(() => {\r\n\t\t\t\tthis.logger.emit(`[ws] Heartbeat ping: ${this.ws.ping}`);\r\n\t\t\t}, 30000);\r\n\t\t} catch (error) {\r\n\t\t\tthrow this.logger.emit(\r\n\t\t\t\t`Uncaught error while attempting init sequence: \\n${error}`,\r\n\t\t\t\tLogLevel.Error\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tasync registerCommands() {\r\n\t\tconst commandFiles = fs.readdirSync(this.commandFolder).filter(file => file.endsWith('.js'));\r\n\t\tthis.logger.emit(`commandfiles = ${commandFiles}`, LogLevel.Verbose);\r\n\r\n\t\tfor (const file of commandFiles) {\r\n\t\t\tconst fullPath = path.resolve(path.join(this.commandFolder, file));\r\n\t\t\tthis.logger.emit(`fullPath = ${fullPath}`, LogLevel.Verbose);\r\n\t\t\tthis.logger.emit(`Attempting to register commands in ${fullPath}`, LogLevel.Debug);\r\n\t\t\tlet command!: Command;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tcommand = new (await import(fullPath)).default(this);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.logger.emit(`Error while registering commands: \\n${error}`, LogLevel.Error);\r\n\t\t\t}\r\n\r\n\t\t\tthis.logger.emit(`command = ${command.name}`, LogLevel.Verbose);\r\n\t\t\tthis.commands.set(command.name, command);\r\n\r\n\t\t\tcommand.aliases?.forEach((alias: string) => {\r\n\t\t\t\t/* Clone command without using slow Object.setPrototypeOf()\r\n\t\t\t\tThis isn't clean but registers aliases as first-class commands,\r\n\t\t\t\tsimplifying the command search in the dispatcher */\r\n\t\t\t\tconst newCmd = Object.assign(Object.create(Object.getPrototypeOf(command)), command);\r\n\t\t\t\tnewCmd.name = alias;\r\n\t\t\t\tthis.commands.set(alias, newCmd);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync eventDispatcher() {\r\n\t\tconst eventFiles = fs.readdirSync(this.eventFolder).filter(file => file.endsWith('.js'));\r\n\r\n\t\tfor (const file of eventFiles) {\r\n\t\t\tconst fullPath = path.resolve(path.join(this.eventFolder, file));\r\n\t\t\tconst event = new (await import(fullPath)).default(this);\r\n\t\t\tconst eName: string = event.name || file;\r\n\t\t\tconst once: boolean = event.once;\r\n\r\n\t\t\tthis[once ? 'once' : 'on'](eName, (...args) => {\r\n\t\t\t\tevent.run(...args);\r\n\t\t\t\tthis.logger.emit(`dispatched event with name ${eName}`, LogLevel.Debug);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync commandDispatcher(message: Message | PartialMessage) {\r\n\t\tif (\r\n\t\t\tmessage.partial ||\r\n\t\t\t!message.content.startsWith(this.prefix) ||\r\n\t\t\tmessage.content.length < this.prefix.length ||\r\n\t\t\tmessage.author.bot\r\n\t\t)\r\n\t\t\treturn;\r\n\r\n\t\tconst args = message.content.slice(this.prefix.length).split(' ');\r\n\t\tconst command = args.shift()?.toLowerCase() as string;\r\n\t\tif (!this.commands.has(command)) return;\r\n\r\n\t\tif (command === 'reload') {\r\n\t\t\tawait this.registerCommands();\r\n\t\t\tmessage.reply('reloaded');\r\n\t\t} else if (command === 'unload') {\r\n\t\t\tconst hasCmd = this.commands.has(args[0]);\r\n\t\t\tthis.logger.emit(`hasCmd ${hasCmd}`, LogLevel.Verbose);\r\n\t\t\tif (!hasCmd) return;\r\n\t\t\tthis.commands.delete(args[0]);\r\n\t\t\tthis.logger.emit(Array.from(this.commands.keys()).toString(), LogLevel.Verbose);\r\n\t\t\tmessage.reply('unloaded');\r\n\t\t} else if (command === 'reinit') {\r\n\t\t\tawait this.init();\r\n\t\t\tmessage.reply('reinit');\r\n\t\t}\r\n\r\n\t\tthis.logger.emit(\r\n\t\t\t`commandKeys = ${Array.from(this.commands.keys())\r\n\t\t\t\t.join(', ')\r\n\t\t\t\t.toString()}`,\r\n\t\t\tLogLevel.Verbose\r\n\t\t);\r\n\r\n\t\t// Simpler search mentioned in registerCommands()\r\n\t\tconst cmd = this.commands.find(cmd => cmd.name === command);\r\n\t\tif (!cmd)\r\n\t\t\tthrow this.logger.emit(`Could not find command with name ${command}`, LogLevel.Warning);\r\n\r\n\t\tif (cmd.ownerOnly && !this.owners.includes(message.author.id)) return;\r\n\t\tcmd.run(message, args);\r\n\t\tthis.logger.emit(`dispatched command with name ${cmd.name}`, LogLevel.Debug);\r\n\t}\r\n}\r\n","import { Message } from 'discord.js';\r\nimport { BotClass } from './BotClass';\r\n\r\nexport abstract class Command {\r\n\tconstructor(client: BotClass) {\r\n\t\tthis.client = client;\r\n\t}\r\n\r\n\tclient!: BotClass;\r\n\tabstract name: string;\r\n\taliases?: string[];\r\n\townerOnly?: boolean = false;\r\n\tabstract description: string;\r\n\tabstract run(message: Message, args: string[]): Promise<Message | void> | void;\r\n\tprotected shouldHandle = true;\r\n}\r\n","import { BotClass } from './BotClass';\n\nexport abstract class Event {\n\tconstructor(client: BotClass) {\n\t\tthis.client = client;\n\t}\n\n\tclient: BotClass;\n\tonce: boolean = false;\n\tabstract name: string;\n\tabstract run(...args: any[]): void;\n}\n"],"names":["red","yellow","blue","magenta","green","pkg","LogLevel","Logger","constructor","level","Info","emit","message","console","log","colors","toString","BotClass","Client","prefix","token","owners","options","Collection","logger","logLevel","commandFolder","path","resolve","eventFolder","init","registerCommands","eventDispatcher","on","commandDispatcher","login","setInterval","ws","ping","error","Error","commandFiles","fs","filter","file","endsWith","Verbose","fullPath","join","Debug","command","default","name","commands","set","aliases","forEach","alias","newCmd","Object","assign","create","getPrototypeOf","eventFiles","event","eName","once","args","run","partial","content","startsWith","length","author","bot","slice","split","shift","toLowerCase","has","reply","hasCmd","delete","Array","from","keys","cmd","find","Warning","ownerOnly","includes","id","Command","client","Event"],"mappings":"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"}